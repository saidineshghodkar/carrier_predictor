<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-driven career assessment for students">
    <meta name="author" content="CareerPath Pro">
    <title>CareerPath Pro - Advanced AI Career Guidance</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* ==================== CSS VARIABLES & RESET ==================== */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #4f46e5;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-light: #64748b;
            --border-radius: 16px;
            --shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: var(--background); min-height: 100vh; color: var(--text-main); line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

        /* ==================== COMPONENT STYLES ==================== */
        
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .header::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/cubes.png'); opacity: 0.1;
        }

        .header h1 { font-size: 2.2rem; margin-bottom: 10px; font-weight: 800; }
        .header p { font-size: 1.1rem; opacity: 0.9; max-width: 600px; margin: 0 auto; }

        .card {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        /* Progress & Timer */
        .progress-bar-container {
            height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; margin: 20px 0;
        }
        .progress-bar-fill {
            height: 100%; background: var(--success); width: 0%; transition: width 0.5s ease;
        }
        .timer-badge {
            position: fixed; top: 20px; right: 20px;
            background: var(--surface); color: var(--danger);
            padding: 10px 20px; border-radius: 50px;
            font-weight: bold; box-shadow: var(--shadow);
            z-index: 100; border: 2px solid #fee2e2;
        }

        /* Questions */
        .question-card { animation: slideIn 0.4s ease; }
        .question-text { font-size: 1.25rem; font-weight: 700; margin-bottom: 20px; color: var(--text-main); }
        
        .options-grid { display: grid; gap: 12px; }
        .option-btn {
            padding: 16px; border: 2px solid #e2e8f0; border-radius: 12px;
            background: var(--surface); cursor: pointer; text-align: left;
            transition: var(--transition); display: flex; align-items: center; gap: 12px;
        }
        .option-btn:hover { border-color: var(--primary); background: #eff6ff; }
        .option-btn.selected { border-color: var(--primary); background: #eff6ff; outline: 2px solid var(--primary); }
        .option-circle { 
            width: 24px; height: 24px; border-radius: 50%; border: 2px solid #cbd5e1; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .option-btn.selected .option-circle { border-color: var(--primary); background: var(--primary); }
        .option-btn.selected .option-circle::after { content: '✓'; color: white; font-size: 14px; }

        /* Sliders */
        .range-container { margin: 30px 0; padding: 0 10px; }
        input[type=range] { width: 100%; accent-color: var(--primary); cursor: pointer; }
        .range-labels { display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-light); margin-top: 10px; }
        .range-value { text-align: center; font-size: 1.5rem; font-weight: bold; color: var(--primary); margin-bottom: 10px; }

        /* Dashboard */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .stat-card { background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .career-badge { 
            display: inline-block; padding: 5px 12px; border-radius: 20px; 
            font-size: 0.8rem; font-weight: 600; background: #e0e7ff; color: var(--primary); 
            margin: 0 5px 5px 0;
        }

        /* Roadmap */
        .roadmap-step { 
            position: relative; padding-left: 40px; padding-bottom: 30px; 
            border-left: 3px solid #e2e8f0; 
        }
        .roadmap-step:last-child { border-left: 3px solid transparent; }
        .roadmap-step::before {
            content: ''; position: absolute; left: -11px; top: 0;
            width: 20px; height: 20px; border-radius: 50%;
            background: var(--surface); border: 4px solid var(--primary);
        }
        .step-title { font-weight: bold; color: var(--text-main); font-size: 1.1rem; }
        .step-desc { font-size: 0.95rem; color: var(--text-light); }

        /* Chatbot */
        .chat-widget {
            position: fixed; bottom: 30px; right: 30px; z-index: 999;
        }
        .chat-toggle {
            width: 60px; height: 60px; border-radius: 50%; background: var(--primary);
            color: white; display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer; box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
            transition: transform 0.2s;
        }
        .chat-toggle:hover { transform: scale(1.1); }
        
        .chat-window {
            position: absolute; bottom: 80px; right: 0; width: 350px; height: 500px;
            background: var(--surface); border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: none; flex-direction: column; overflow: hidden; border: 1px solid #e2e8f0;
        }
        .chat-header { padding: 15px; background: var(--primary); color: white; font-weight: bold; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #f8fafc; }
        .chat-msg { 
            padding: 10px 15px; border-radius: 12px; margin-bottom: 10px; font-size: 0.95rem; max-width: 85%; 
        }
        .bot-msg { background: white; border: 1px solid #e2e8f0; align-self: flex-start; border-bottom-left-radius: 2px; }
        .user-msg { background: var(--primary); color: white; align-self: flex-end; margin-left: auto; border-bottom-right-radius: 2px; }
        .chat-input-area { padding: 15px; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; }
        .chat-input { 
            flex: 1; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; outline: none; 
        }

        /* Buttons & Utils */
        .btn {
            padding: 12px 24px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer;
            transition: var(--transition); display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); }
        .btn-outline { background: transparent; border: 2px solid var(--text-light); color: var(--text-light); }
        .w-full { width: 100%; justify-content: center; }
        .hidden { display: none; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="timer-badge hidden" id="timerDisplay">
    <i class="far fa-clock"></i> <span id="timeRemaining">10:00</span>
</div>

<div class="container">
    
    <!-- HEADER -->
    <div class="header">
        <h1>CareerPath Pro <span style="font-size: 0.5em; vertical-align: super; opacity: 0.8">BETA</span></h1>
        <p>Advanced AI-driven career discovery for 10th-grade graduates.</p>
    </div>

    <!-- WELCOME SCREEN -->
    <div id="welcomeScreen" class="card" style="text-align: center; padding: 50px 20px;">
        <i class="fas fa-compass" style="font-size: 60px; color: var(--primary); margin-bottom: 20px;"></i>
        <h2>Discover Your Perfect Stream</h2>
        <p style="color: var(--text-light); margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto;">
            Our algorithm analyzes <strong>Academic Aptitude</strong>, <strong>Interest Patterns</strong>, and <strong>Behavioral Traits</strong> to recommend the most suitable career path.
        </p>
        <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 30px;">
            <div class="stat-card"><strong>3 Sections</strong><br><span style="font-size:0.8rem">Academics, Interests, Behavior</span></div>
            <div class="stat-card"><strong>~5 Minutes</strong><br><span style="font-size:0.8rem">Estimated Time</span></div>
        </div>
        <button id="startBtn" class="btn btn-primary">Start Assessment <i class="fas fa-arrow-right"></i></button>
    </div>

    <!-- ASSESSMENT UI -->
    <div id="assessmentScreen" class="hidden">
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar-fill"></div>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <span id="sectionTitle" style="font-weight: bold; color: var(--primary); text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px;">SECTION A: ACADEMICS</span>
                <span id="questionCount" style="color: var(--text-light); font-size: 0.9rem;">1/15</span>
            </div>

            <div id="questionContainer"></div>

            <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                <button class="btn btn-outline" id="prevBtn" disabled>Previous</button>
                <button class="btn btn-primary" id="nextBtn">Next <i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    <!-- LOADING SCREEN -->
    <div id="loadingScreen" class="card hidden" style="text-align: center; padding: 60px;">
        <i class="fas fa-circle-notch fa-spin" style="font-size: 50px; color: var(--primary); margin-bottom: 20px;"></i>
        <h3>Analyzing Your Profile...</h3>
        <p id="loadingText" style="color: var(--text-light);">Mapping academic strengths...</p>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboardScreen" class="hidden">
        <div class="card" style="border-left: 5px solid var(--success);">
            <h2><i class="fas fa-check-circle" style="color: var(--success);"></i> Assessment Complete</h2>
            <p>Based on our analysis, your profile strongly aligns with the following path:</p>
        </div>

        <div class="dashboard-grid">
            <!-- Main Result -->
            <div class="card" style="grid-column: span 2;">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div id="careerIcon" style="width: 50px; height: 50px; background: var(--primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;"></div>
                    <div>
                        <div style="font-size: 0.85rem; color: var(--text-light); text-transform: uppercase;">Top Recommendation</div>
                        <h2 id="careerTitle" style="margin: 0; color: var(--text-main);">Engineering</h2>
                    </div>
                </div>
                <p id="careerReason" style="color: var(--text-light); margin-bottom: 20px;"></p>
                <div id="careerTags"></div>
            </div>

            <!-- Chart -->
            <div class="card" style="height: 350px; position: relative;">
                <canvas id="radarChart"></canvas>
            </div>

            <!-- Roadmap -->
            <div class="card" style="grid-column: span 3;">
                <h3><i class="fas fa-map-signs" style="color: var(--accent);"></i> Your 5-Year Roadmap</h3>
                <div id="roadmapContainer" style="margin-top: 20px;"></div>
            </div>

            <!-- Alternate Options -->
            <div class="card" style="grid-column: span 3;">
                <h3>Alternative Paths</h3>
                <div id="altPaths" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;"></div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button id="retakeBtn" class="btn btn-outline"><i class="fas fa-redo"></i> Retake Assessment</button>
            <button id="saveReportBtn" class="btn btn-primary"><i class="fas fa-download"></i> Save Report</button>
        </div>
    </div>

</div>

<!-- CHATBOT -->
<div class="chat-widget">
    <div class="chat-toggle" id="chatToggle">
        <i class="fas fa-comment-dots"></i>
    </div>
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            Career Assistant
            <span style="float: right; cursor: pointer;" id="chatClose">×</span>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="chat-msg bot-msg">Hi! I'm your AI counselor. Once you finish the test, I can explain your results or answer questions about colleges!</div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask a question...">
            <button class="btn btn-primary" style="padding: 8px 15px;" id="chatSendBtn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<!-- JAVASCRIPT LOGIC -->
<script>
    // --- DATA & CONFIG ---
    const careerClusters = {
        engineering: {
            name: "Engineering & Tech",
            desc: "Ideal for analytical minds who love building systems, coding, or working with machinery.",
            streams: ["MPC (Math, Physics, Chem)", "Diploma in Engg"],
            colleges: ["IITs", "NITs", "BITS", "State Govt Colleges"],
            exams: ["JEE Mains", "JEE Advanced", "BITSAT"],
            icon: "fas fa-microchip",
            color: "#2563eb"
        },
        medical: {
            name: "Medical & Healthcare",
            desc: "For those with high empathy and strong aptitude in biological sciences.",
            streams: ["BiPC (Bio, Physics, Chem)"],
            colleges: ["AIIMS", "JIPMER", "State Medical Colleges"],
            exams: ["NEET", "AIIMS Entrance"],
            icon: "fas fa-user-md",
            color: "#10b981"
        },
        commerce: {
            name: "Commerce & Finance",
            desc: "Suits data-driven individuals interested in markets, economy, and management.",
            streams: ["MEC (Math, Eco, Com)", "CEC (Civics, Eco, Com)"],
            colleges: ["SRCC", "IIMs (IPM)", "Christ University"],
            exams: ["CA Foundation", "CUET", "IPMAT"],
            icon: "fas fa-chart-line",
            color: "#f59e0b"
        },
        humanities: {
            name: "Humanities & Law",
            desc: "For critical thinkers interested in society, policy, psychology, and expression.",
            streams: ["HEC (History, Eco, Civics)", "Psychology"],
            colleges: ["JNU", "Ashoka Univ", "NALSAR (Law)"],
            exams: ["CLAT", "CUET", "AIAET"],
            icon: "fas fa-balance-scale",
            color: "#8b5cf6"
        },
        creative: {
            name: "Creative & Design",
            desc: "For visual thinkers who want to pursue design, media, architecture, or arts.",
            streams: ["Any Stream (Design focus)", "Fine Arts"],
            colleges: ["NID", "NIFT", "JJ School of Art"],
            exams: ["NID DAT", "UCEED", "NIFT Entrance"],
            icon: "fas fa-palette",
            color: "#ec4899"
        },
        vocational: {
            name: "Vocational & Defense",
            desc: "Practical, hands-on careers or service to the nation requiring discipline.",
            streams: ["Vocational Courses", "NDA Prep"],
            colleges: ["NDA", "Hotel Mgmt Institutes", "ITIs"],
            exams: ["NDA Exam", "NCHMCT JEE"],
            icon: "fas fa-shield-alt",
            color: "#64748b"
        }
    };

    const questions = [
        // SECTION A: ACADEMICS (Marks & Aptitude)
        {
            id: 'q1', section: 'Academic', type: 'range',
            text: "How much did you score in Mathematics/Science in 10th?",
            min: 0, max: 100,
            weights: { engineering: 30, medical: 20, commerce: 10 }
        },
        {
            id: 'q2', section: 'Academic', type: 'range',
            text: "How much did you score in Social Studies/English?",
            min: 0, max: 100,
            weights: { humanities: 30, commerce: 10, creative: 15 }
        },
        {
            id: 'q3', section: 'Academic', type: 'choice',
            text: "Which subject homework did you finish first because you liked it?",
            options: [
                { text: "Math problems / Physics derivations", weights: { engineering: 20, commerce: 5 } },
                { text: "Biology diagrams / Chemistry labs", weights: { medical: 25 } },
                { text: "History stories / Civics debates", weights: { humanities: 20 } },
                { text: "Drawing / Craft / Music", weights: { creative: 25 } }
            ]
        },
        // SECTION B: INTERESTS (Hobbies & Preferences)
        {
            id: 'q4', section: 'Interest', type: 'choice',
            text: "If given a free Sunday, what would you pick?",
            options: [
                { text: "Coding a game or fixing a gadget", weights: { engineering: 20, vocational: 10 } },
                { text: "Reading about health or volunteering at a camp", weights: { medical: 20, humanities: 10 } },
                { text: "Trading stocks (mock) or managing event budget", weights: { commerce: 25 } },
                { text: "Sketching, editing video, or writing poetry", weights: { creative: 25 } }
            ]
        },
        {
            id: 'q5', section: 'Interest', type: 'choice',
            text: "Which YouTube content do you watch most?",
            options: [
                { text: "Tech reviews / How It's Made", weights: { engineering: 15, vocational: 10 } },
                { text: "Documentaries / Political Analysis", weights: { humanities: 20 } },
                { text: "Business Case Studies / Shark Tank", weights: { commerce: 20 } },
                { text: "Art tutorials / Design trends", weights: { creative: 20 } }
            ]
        },
        // SECTION C: BEHAVIORAL (Scenarios)
        {
            id: 'q6', section: 'Behavioral', type: 'choice',
            text: "A complex machine breaks down. You:",
            options: [
                { text: "Find the manual and read the logic", weights: { engineering: 15 } },
                { text: "Open it up and start tinkering", weights: { vocational: 20, engineering: 10 } },
                { text: "Call support and negotiate a replacement", weights: { commerce: 10, humanities: 5 } },
                { text: "Don't care, I focus on how it looked anyway", weights: { creative: 10 } }
            ]
        },
        {
            id: 'q7', section: 'Behavioral', type: 'choice',
            text: "Your ideal work environment is:",
            options: [
                { text: "A quiet lab or computer desk solving problems", weights: { engineering: 10, medical: 10 } },
                { text: "A busy hospital or field working with people", weights: { medical: 15, vocational: 10 } },
                { text: "A corporate boardroom dealing with clients", weights: { commerce: 15 } },
                { text: "A studio with flexible hours and creative freedom", weights: { creative: 20 } }
            ]
        },
        {
            id: 'q8', section: 'Motivation', type: 'choice',
            text: "What motivates you most?",
            options: [
                { text: "Innovation & Technology", weights: { engineering: 15 } },
                { text: "Helping People / Saving Lives", weights: { medical: 20 } },
                { text: "Money, Power & Business", weights: { commerce: 15 } },
                { text: "Expression, Fame & Art", weights: { creative: 15 } },
                { text: "Serving the Nation / Discipline", weights: { vocational: 20 } }
            ]
        }
    ];

    // --- APP ENGINE ---
    const app = {
        currentQIndex: 0,
        scores: { engineering: 0, medical: 0, commerce: 0, humanities: 0, creative: 0, vocational: 0 },
        answers: {},
        timerInterval: null,

        init() {
            this.setupEventListeners();
        },

        setupEventListeners() {
            // Main buttons
            document.getElementById('startBtn').addEventListener('click', () => this.startAssessment());
            document.getElementById('prevBtn').addEventListener('click', () => this.prevQuestion());
            document.getElementById('nextBtn').addEventListener('click', () => this.nextQuestion());
            document.getElementById('retakeBtn').addEventListener('click', () => location.reload());
            document.getElementById('saveReportBtn').addEventListener('click', () => window.print());
            
            // Chatbot
            document.getElementById('chatToggle').addEventListener('click', () => chatbot.toggle());
            document.getElementById('chatClose').addEventListener('click', () => chatbot.toggle());
            document.getElementById('chatSendBtn').addEventListener('click', () => chatbot.send());
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if(e.key === 'Enter') chatbot.send();
            });
        },

        startAssessment() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('assessmentScreen').classList.remove('hidden');
            document.getElementById('timerDisplay').classList.remove('hidden');
            this.renderQuestion();
            this.startTimer(600); // 10 minutes
        },

        startTimer(duration) {
            let timer = duration;
            const display = document.getElementById('timeRemaining');
            
            if(this.timerInterval) clearInterval(this.timerInterval);
            
            this.timerInterval = setInterval(() => {
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (--timer < 0) {
                    clearInterval(this.timerInterval);
                    this.finishAssessment();
                }
            }, 1000);
        },

        renderQuestion() {
            const q = questions[this.currentQIndex];
            const container = document.getElementById('questionContainer');
            
            // Update Progress
            const progress = ((this.currentQIndex) / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('questionCount').innerText = `${this.currentQIndex + 1}/${questions.length}`;
            document.getElementById('sectionTitle').innerText = `SECTION: ${q.section.toUpperCase()}`;

            let html = `<div class="question-card">
                        <div class="question-text">${this.escapeHtml(q.text)}</div>`;

            if (q.type === 'range') {
                html += `<div class="range-container">
                            <div class="range-value" id="val-${q.id}">50</div>
                            <input type="range" min="${q.min}" max="${q.max}" value="50" id="range-${q.id}">
                            <div class="range-labels"><span>Low</span><span>High</span></div>
                         </div>`;
                // Auto-save default value
                this.answers[q.id] = { val: 50, weights: q.weights };
            } else {
                html += `<div class="options-grid">`;
                q.options.forEach((opt, idx) => {
                    html += `<div class="option-btn" data-index="${idx}">
                                <div class="option-circle"></div>
                                ${this.escapeHtml(opt.text)}
                             </div>`;
                });
                html += `</div>`;
            }
            html += `</div>`;
            container.innerHTML = html;

            // Add event listeners for dynamic elements
            if (q.type === 'range') {
                const rangeInput = document.getElementById(`range-${q.id}`);
                const rangeValue = document.getElementById(`val-${q.id}`);
                
                rangeInput.addEventListener('input', (e) => {
                    const value = e.target.value;
                    rangeValue.textContent = value;
                    this.answers[q.id] = { val: parseInt(value), weights: q.weights };
                });
            } else {
                const optionButtons = document.querySelectorAll('.option-btn');
                optionButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const allOpts = document.querySelectorAll('.option-btn');
                        allOpts.forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        
                        // Save Data
                        const idx = parseInt(btn.dataset.index);
                        this.answers[q.id] = { val: 1, weights: q.options[idx].weights };
                    });
                });
            }

            // Manage buttons
            document.getElementById('prevBtn').disabled = this.currentQIndex === 0;
            document.getElementById('nextBtn').innerText = this.currentQIndex === questions.length - 1 ? "Finish" : "Next";
        },

        selectOption(el, idx) {
            // UI Toggle
            const allOpts = document.querySelectorAll('.option-btn');
            allOpts.forEach(btn => btn.classList.remove('selected'));
            el.classList.add('selected');

            // Save Data
            const q = questions[this.currentQIndex];
            this.answers[q.id] = { val: 1, weights: q.options[idx].weights }; // 1 indicates selection
        },

        nextQuestion() {
            const currentQ = questions[this.currentQIndex];
            if (!this.answers[currentQ.id]) {
                alert("Please select an option.");
                return;
            }
            if (this.currentQIndex < questions.length - 1) {
                this.currentQIndex++;
                this.renderQuestion();
            } else {
                this.finishAssessment();
            }
        },

        prevQuestion() {
            if (this.currentQIndex > 0) {
                this.currentQIndex--;
                this.renderQuestion();
            }
        },

        finishAssessment() {
            clearInterval(this.timerInterval);
            document.getElementById('assessmentScreen').classList.add('hidden');
            document.getElementById('timerDisplay').classList.add('hidden');
            document.getElementById('loadingScreen').classList.remove('hidden');

            this.calculateScores();

            // Simulate AI Delay
            let steps = ["Analyzing marks...", "Mapping hobbies...", "Checking career alignment...", "Generating roadmap..."];
            let i = 0;
            let interval = setInterval(() => {
                document.getElementById('loadingText').innerText = steps[i];
                i++;
                if (i >= steps.length) {
                    clearInterval(interval);
                    this.showDashboard();
                }
            }, 800);
        },

        calculateScores() {
            // Reset scores
            this.scores = { engineering: 0, medical: 0, commerce: 0, humanities: 0, creative: 0, vocational: 0 };
            
            // Weighted Logic
            Object.values(this.answers).forEach(ans => {
                const multiplier = typeof ans.val === 'number' ? (ans.val / 100) : 1;
                for (const [category, weight] of Object.entries(ans.weights)) {
                    if (this.scores[category] !== undefined) {
                        this.scores[category] += weight * multiplier;
                    }
                }
            });
        },

        showDashboard() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('hidden');

            // Find Top Career
            const sorted = Object.entries(this.scores).sort((a, b) => b[1] - a[1]);
            const topKey = sorted[0][0];
            const topCareer = careerClusters[topKey];
            
            // Set Global for Chatbot
            window.userResult = topCareer;

            // Render Dashboard Data
            document.getElementById('careerTitle').innerText = topCareer.name;
            document.getElementById('careerReason').innerText = topCareer.desc;
            document.getElementById('careerIcon').innerHTML = `<i class="${topCareer.icon}"></i>`;
            
            // Render Tags
            let tagsHtml = `<div class="career-badge">Primary Stream: ${this.escapeHtml(topCareer.streams[0])}</div>`;
            topCareer.colleges.slice(0, 2).forEach(c => tagsHtml += `<div class="career-badge">${this.escapeHtml(c)}</div>`);
            document.getElementById('careerTags').innerHTML = tagsHtml;

            // Render Chart
            this.renderChart(this.scores);

            // Render Roadmap
            const roadmapHtml = `
                <div class="roadmap-step">
                    <div class="step-title">Class 11 & 12</div>
                    <div class="step-desc">Select ${this.escapeHtml(topCareer.streams.join(' or '))}. Focus on core subjects.</div>
                </div>
                <div class="roadmap-step">
                    <div class="step-title">Entrance Exams</div>
                    <div class="step-desc">Prepare for ${this.escapeHtml(topCareer.exams.join(', '))}.</div>
                </div>
                <div class="roadmap-step">
                    <div class="step-title">Undergraduate Degree</div>
                    <div class="step-desc">Enroll in top colleges like ${this.escapeHtml(topCareer.colleges[0])}.</div>
                </div>
                <div class="roadmap-step">
                    <div class="step-title">Career Launch</div>
                    <div class="step-desc">Internships and entry-level jobs in ${this.escapeHtml(topCareer.name)}.</div>
                </div>
            `;
            document.getElementById('roadmapContainer').innerHTML = roadmapHtml;

            // Alternate Paths
            const altHtml = sorted.slice(1, 3).map(k => {
                const c = careerClusters[k[0]];
                return `<div class="stat-card">
                            <strong>${this.escapeHtml(c.name)}</strong>
                            <p style="font-size:0.8rem; color:var(--text-light)">${this.escapeHtml(c.streams[0])}</p>
                        </div>`;
            }).join('');
            document.getElementById('altPaths').innerHTML = altHtml;
        },

        renderChart(scores) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(scores).map(k => k.charAt(0).toUpperCase() + k.slice(1)),
                    datasets: [{
                        label: 'Match Score',
                        data: Object.values(scores),
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb',
                        pointBackgroundColor: '#2563eb'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        r: { 
                            beginAtZero: true, 
                            grid: { color: '#e2e8f0' },
                            ticks: { display: false }
                        } 
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        },

        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    };

    // --- CHATBOT LOGIC ---
    const chatbot = {
        visible: false,
        toggle() {
            this.visible = !this.visible;
            document.getElementById('chatWindow').style.display = this.visible ? 'flex' : 'none';
        },
        send() {
            const input = document.getElementById('chatInput');
            const txt = input.value.trim();
            if (!txt) return;
            
            this.addMsg(txt, 'user');
            input.value = '';

            // Simple Logic
            setTimeout(() => {
                let reply = "I'm still learning! Try asking about colleges or exams.";
                const lower = txt.toLowerCase();
                
                if (!window.userResult) {
                    reply = "Please complete the assessment first so I can guide you better.";
                } else {
                    const c = window.userResult;
                    if (lower.includes('why')) reply = `Based on your test, you showed strong aptitude for ${c.name}.`;
                    else if (lower.includes('college')) reply = `Top colleges for you are ${c.colleges.join(', ')}.`;
                    else if (lower.includes('exam')) reply = `You should prepare for ${c.exams.join(', ')}.`;
                    else if (lower.includes('salary') || lower.includes('scope')) reply = "This field has excellent growth potential over the next decade.";
                }
                this.addMsg(reply, 'bot');
            }, 800);
        },
        addMsg(txt, type) {
            const body = document.getElementById('chatBody');
            body.innerHTML += `<div class="chat-msg ${type}-msg">${app.escapeHtml(txt)}</div>`;
            body.scrollTop = body.scrollHeight;
        }
    };

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        app.init();
    });
</script>

</body>
</html>
